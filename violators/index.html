<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="jquery-3.4.1.min.js"></script>
    <script src="jspdf.min.js"></script>
    <script src="jspdf.plugin.autotable.js"></script>
    <title>Document</title>
    <style>
        table {
            margin: 0 auto;
            border-collapse: collapse;
        }

        td {
            border: 1px solid #ccc;
            padding: 5px 15px;
        }

        .controls {
            padding: 10px;
            border: 1px solid #aaa;
            background-color: aquamarine;
            margin: 10px;
            text-align: center;
        }
    </style>
</head>

<body style="text-align: center;">
    <div class="controls">

        <form id="ak-form">
            From Date: <input type="date" id="from_date" required>
            To Date: <input type="date" id="to_date" required>
            <select id="choice">
                <option value="1">Data Not Received</option>
                <option value="2">Quarantine Violation</option>
            </select>
            <button type="submit">Get data</button>
        </form>

    </div>

    <table id="list-violators">
        <tr>
            <td>Head 1</td>
            <td>Head 2</td>
            <td>Head 3</td>
        </tr>
    </table>
    <button onclick="downloadViolators()">Download</button>

    <div style="text-align: center; padding: 20px">
        Used API in code - @Karthi copy paste to URL for Testing.<br>
        <span id="fired-api" style="color:green;"></span>
    </div>

    <script>

        let apiHost = "https://covid19.cdacchn.in:8080/api/listviolators";

        let cred = { current_state_id: 36, current_user_id: 3222, current_user_name: 8888888885  };

        function getData() {

            console.log(document.getElementById("from_date").value);
        }

        function listViolatorsAddToTable(arr) {

            $("#list-violators").empty();

            var table = $("#list-violators");

            row = $('<tr />');

                table.append(row);

                cell = $('<td>Head 1</td><td>Head 2</td><td>Head 3</td>')

                row.append(cell);

            arr.forEach(function (item, index) {

                row = $('<tr />');

                table.append(row);

                cell = $('<td>' + item[0] + '</td><td>' + item[1] + '</td><td>' + item[2] + '</td>')

                row.append(cell);
            });

        }

        $('#ak-form').submit(function (e) {

            e.preventDefault();

            let params = {
                ...cred, from_date: document.getElementById("from_date").value, to_date: document.getElementById("to_date").value, choice: document.getElementById("choice").value
            }

            console.log(params);

            getDataFromAPI(params);
        });


        function downloadViolators() {

            var doc = new jsPDF();

            doc.autoTable({ html: '#list-violators' });

            doc.save('download.pdf');
        }

        function getDataFromAPI(params) {

            console.log(apiHost.concat("?", $.param(params)));

            $("#fired-api").text(apiHost.concat("?", $.param(params)))

            $.get(apiHost, params, function (res) {

                console.log(res);

                listViolatorsAddToTable(res.data);
            });
        }

        $(function () {

            getDataFromAPI(cred);

        })

    </script>
</body>

</html>