<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        div {
            border: 1px solid #ececec;
            padding: 10px;
            margin: 10px;
        }
    </style>
</head>

<body>
    <select name="district" id="district">
        <option value="Yavatmol">Yavatmol</option>
        <option value="Dist2">Dist2</option>
    </select>

    <div>Houses
        <div id="houses">No Data</div>
    </div>
    <div>Citzen
        <div id="Citzen">No Data</div>
    </div>
    <div>Contact History
        <div id="Contact-history">No Data</div>
    </div>
    <div>Diabetes
        <div id="Diabetes">No Data</div>
    </div>
    <div>Family
        <div id="Family">No Data</div>
    </div>
    <div>Hyper Tension
        <div id="Hyper-tension">No Data</div>
    </div>
    <div>Travel History
        <div id="Travel-history">No Data</div>
    </div>


    <div>
        <canvas id="groupedBarChart" width="400" height="400"></canvas>
    </div>

    <div>
        <canvas id="pie1Chart" width="400" height="400"></canvas>
    </div>

    <div>
        <canvas id="pie2Chart" width="400" height="400"></canvas>
    </div>


    <script src="static/jquery-3.2.1.min.js"></script>
    <script src="static/Chart.min.js"></script>

    <script>
        let apiHost = "https://covid19.cdacchn.in:8080";

        let selectedDistrictId = 376

        $(function () {

            $.get(apiHost.concat("/survey/count"), { district_id: selectedDistrictId }, function (res) {

                // console.log(res);

                if (res.status == true) {

                    $("#Citzen").html(res.data.Citzen)

                    $("#Contact-history").html(res.data['Contact-history'])

                    $("#Diabetes").html(res.data['Diabetes'])

                    $("#Family").html(res.data['Family'])

                    $("#Hyper-tension").html(res.data['Hyper-tension'])

                    $("#Travel-history").html(res.data['Travel-history'])
                }
            });

            $.get(apiHost.concat("/survey/bar"), { district_id: selectedDistrictId }, function (res) {

                console.log(res)

                if (res.status == true) {

                    let labels = Object.keys(res.data);

                    let maleData = [], femaleData = [], otherData = [];

                    labels.forEach(function (value, index) {

                        maleData.push(res.data[value].male);

                        femaleData.push(res.data[value].female);

                        otherData.push(res.data[value].other);
                    })

                    groupedBarChartData.labels = labels;

                    groupedBarChartData.datasets[0].data = maleData

                    groupedBarChartData.datasets[1].data = femaleData

                    groupedBarChartData.datasets[2].data = otherData

                    groupedBarChart.update();
                }


            });

            $.get(apiHost.concat("/survey/pie1"), { district_id: selectedDistrictId }, function (res) {

                // console.log('pie1', res)

                if (res.status == true) {

                    Object.keys(res.data).forEach(function (value, index) {

                        updatePieChart(pie1Chart, value, res.data[value])
                    })
                }
            });

            $.get(apiHost.concat("/survey/pie2"), { district_id: selectedDistrictId }, function (res) {

                // console.log('pie2', res)

                if (res.status == true) {

                    Object.keys(res.data).forEach(function (value, index) {

                        updatePieChart(pie2Chart, value, res.data[value])
                    })
                }

            });

            var groupedBarChartCtx = document.getElementById("groupedBarChart").getContext("2d");

            var groupedBarChart = new Chart(groupedBarChartCtx, {
                type: "bar",
                data: groupedBarChartData,
                options: groupedBarChartOptions
            });
            var pie1ChartCtx = document.getElementById("pie1Chart").getContext("2d");

            var pie1Chart = new Chart(pie1ChartCtx, {
                type: 'pie',
                data: pie1ChartData,
                options: pie1ChartOptions
            });
            var pie2ChartCtx = document.getElementById("pie2Chart").getContext("2d");

            var pie2Chart = new Chart(pie2ChartCtx, {
                type: 'pie',
                data: pie2ChartData,
                options: pie2ChartOptions
            });


        });

    </script>

    <script>
        var groupedBarChartData = {
            labels: [],
            datasets: [
                {
                    label: "Male",
                    backgroundColor: "pink",
                    borderColor: "red",
                    borderWidth: 1,
                    data: []
                },
                {
                    label: "Female",
                    backgroundColor: "lightblue",
                    borderColor: "blue",
                    borderWidth: 1,
                    data: []
                },
                {
                    label: "Others",
                    backgroundColor: "lightgreen",
                    borderColor: "green",
                    borderWidth: 1,
                    data: []
                },
            ]
        };

        var groupedBarChartOptions = {
            responsive: true,
            legend: {
                position: "top"
            },
            title: {
                display: true,
                text: "Symptoms Status"
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }

        var pie1ChartData = {
            labels: [],
            datasets: [{
                label: "Male Female Others",
                backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                data: []
            }]
        }

        var pie1ChartOptions = {
            title: {
                display: true,
                text: 'Male Female Others'
            }
        }

        var pie2ChartData = {
            labels: [],
            datasets: [{
                label: "ANC/PNC",
                backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                data: []
            }]
        }

        var pie2ChartOptions = {
            title: {
                display: true,
                text: 'ANC/PNC'
            }
        }

        function updatePieChart(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

    </script>
</body>

</html>